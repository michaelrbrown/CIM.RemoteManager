<pages:BasePage Title="Sensors"
                x:Class="CIM.RemoteManager.Core.Pages.SensorListPage"
                xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                xmlns:dataSource="clr-namespace:Syncfusion.DataSource;assembly=Syncfusion.DataSource.Portable" xmlns:pages="clr-namespace:CIM.RemoteManager.Core.Pages;assembly=CIM.RemoteManager.Core" xmlns:syncfusion="clr-namespace:Syncfusion.ListView.XForms;assembly=Syncfusion.SfListView.XForms"
                xmlns:templates="clr-namespace:CIM.RemoteManager.Core.Templates;assembly=CIM.RemoteManager.Core"
                BackgroundColor="#FFFFFF">

    <!-- Background -->
    <Image Aspect="AspectFill" RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height}" RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width}" Source="appbackground.jpg" />

    <StackLayout Padding="10" HorizontalOptions="CenterAndExpand" BackgroundColor="#AE2C3B" IsVisible="{Binding IsStateOn, Converter={StaticResource BooleanToFalseConverter}}">
        <Grid HorizontalOptions="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Image VerticalOptions="Center" HorizontalOptions="End" Source="bluetooth-info.png" />
            <Label Grid.Column="1" VerticalOptions="Center" FontSize="18" Text="{Binding StateText}" TextColor="#FFFFFF" />
        </Grid>
    </StackLayout>

    <!-- Sensor ListView -->
    <syncfusion:SfListView x:Name="SensorLiistView"
                           Margin="0"
                           AllowSwiping="True" HeaderSize="145" IsStickyFooter="True" IsStickyGroupHeader="False" ItemDoubleTapped="SensorListView_OnItemDoubleTapped"
                           ItemSize="116" ItemSpacing="3"
                           ItemsSource="{Binding SensorCollection}"
                           SelectionBackgroundColor="Transparent">

        <!-- Sensor ListView Group DataSource -->
        <syncfusion:SfListView.DataSource>
            <dataSource:DataSource>
                <dataSource:DataSource.GroupDescriptors>
                    <dataSource:GroupDescriptor PropertyName="SensorTypeGroup" />
                </dataSource:DataSource.GroupDescriptors>
            </dataSource:DataSource>
        </syncfusion:SfListView.DataSource>

        <!-- Layout Manager (provides columns on higher resolution devices) -->
        <syncfusion:SfListView.LayoutManager>
            <syncfusion:GridLayout>
                <syncfusion:GridLayout.SpanCount>
                    <OnPlatform x:TypeArguments="x:Int32">
                        <OnPlatform.Android>
                            <OnIdiom x:TypeArguments="x:Int32" Phone="1" Tablet="2" />
                        </OnPlatform.Android>
                        <OnPlatform.iOS>
                            <OnIdiom x:TypeArguments="x:Int32" Phone="1" Tablet="2" />
                        </OnPlatform.iOS>
                    </OnPlatform>
                </syncfusion:GridLayout.SpanCount>
            </syncfusion:GridLayout>
        </syncfusion:SfListView.LayoutManager>

        <!-- Sensor ListView Header Template -->
        <syncfusion:SfListView.HeaderTemplate>
            <DataTemplate>
                <!-- Margin: left, top, right, bottom -->
                <Grid VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand" BackgroundColor="Transparent">

                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="40" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <StackLayout Grid.Row="0" Grid.Column="0"
                                 VerticalOptions="CenterAndExpand" HorizontalOptions="CenterAndExpand"
                                 Orientation="Vertical" Spacing="0">
                        <Label VerticalOptions="Center" HorizontalOptions="Center" Text="{Binding UpdateButtonText, Mode=TwoWay}" TextColor="{DynamicResource BluetoothStatusTextColor}" />
                        <Switch Margin="5" VerticalOptions="Center" HorizontalOptions="Center" Toggled="SensorUpdatesSwitchToggled" />
                    </StackLayout>

                    <Image Grid.Row="0" Grid.Column="1"
                           Margin="10"
                           VerticalOptions="CenterAndExpand" HorizontalOptions="CenterAndExpand"
                           Aspect="AspectFit" HeightRequest="120" Source="remote512.png" WidthRequest="120" />

                    <StackLayout Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                 VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand"
                                 BackgroundColor="{DynamicResource RemoteNameBackgroundColor}"
                                 HeightRequest="40" Orientation="Horizontal" Spacing="0">
                        <Label VerticalOptions="Center" HorizontalOptions="CenterAndExpand" FontSize="20" Text="{Binding DeviceName}" TextColor="{DynamicResource AppLightColor}" />
                    </StackLayout>

                </Grid>
            </DataTemplate>
        </syncfusion:SfListView.HeaderTemplate>

        <!-- Sensor ListView Group Template -->
        <syncfusion:SfListView.GroupHeaderTemplate>
            <DataTemplate>
                <ViewCell>
                    <ViewCell.View>
                        <Frame Margin="5" Padding="10"
                               VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand"
                               BackgroundColor="{StaticResource AppBaseColor}"
                               CornerRadius="10" HasShadow="False">
                            <!-- Margin: left, top, right, bottom -->
                            <Label Margin="0,0,0,0"
                                   VerticalOptions="Center" HorizontalOptions="CenterAndExpand"
                                   FontAttributes="Italic" FontSize="18" HorizontalTextAlignment="Center"
                                   Text="{Binding Key}"
                                   TextColor="{DynamicResource GroupTextColor}"
                                   VerticalTextAlignment="Center" WidthRequest="225" />
                        </Frame>
                    </ViewCell.View>
                </ViewCell>
            </DataTemplate>
        </syncfusion:SfListView.GroupHeaderTemplate>

        <!-- Sensor ListView Item Template -->
        <syncfusion:SfListView.ItemTemplate>
            <DataTemplate>
                <ViewCell>
                    <!-- Sensor Detail Template -->
                    <templates:SensorItemTemplate />
                </ViewCell>
            </DataTemplate>
        </syncfusion:SfListView.ItemTemplate>

        <syncfusion:SfListView.RightSwipeTemplate>
            <DataTemplate x:Name="RightSwipeTemplate">
                <Grid VerticalOptions="Fill" HorizontalOptions="Fill" BackgroundColor="{DynamicResource RemoteNameBackgroundColor}">
                    <Grid VerticalOptions="Center" HorizontalOptions="Center">
                        <Image Grid.Row="0" Grid.Column="0"
                               BackgroundColor="Transparent" HeightRequest="48" Source="ic_sensor-settings.png" WidthRequest="48" />
                    </Grid>
                </Grid>
            </DataTemplate>
        </syncfusion:SfListView.RightSwipeTemplate>

        <!-- Sensor ListView Footer Template -->
        <syncfusion:SfListView.FooterTemplate>
            <DataTemplate>
                <!-- Margin: left, top, right, bottom -->
                <StackLayout VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand"
                             BackgroundColor="{DynamicResource RemoteNameBackgroundColor}"
                             HeightRequest="60" Opacity=".6" Orientation="Horizontal" Spacing="0">
                    <Label Margin="5"
                           VerticalOptions="CenterAndExpand" HorizontalOptions="StartAndExpand"
                           FontSize="16" LineBreakMode="MiddleTruncation"
                           Text="{Binding CharacteristicValue, StringFormat=' Incoming Value: {0:N}'}"
                           TextColor="{DynamicResource AppLightColor}"
                           VerticalTextAlignment="Center" />
                </StackLayout>
            </DataTemplate>
        </syncfusion:SfListView.FooterTemplate>

    </syncfusion:SfListView>

</pages:BasePage>