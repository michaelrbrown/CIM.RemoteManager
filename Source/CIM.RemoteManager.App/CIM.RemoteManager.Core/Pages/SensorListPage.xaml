<pages:BasePage x:Class="CIM.RemoteManager.Core.Pages.SensorListPage"
                xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                xmlns:dataSource="clr-namespace:Syncfusion.DataSource;assembly=Syncfusion.DataSource.Portable" xmlns:pages="clr-namespace:CIM.RemoteManager.Core.Pages;assembly=CIM.RemoteManager.Core" xmlns:syncfusion="clr-namespace:Syncfusion.ListView.XForms;assembly=Syncfusion.SfListView.XForms" xmlns:templates="clr-namespace:CIM.RemoteManager.Core.Templates;assembly=CIM.RemoteManager.Core"
                Title="Sensors"
                Padding="0"
                BackgroundColor="#FFFFFF">

    <!-- BTLE Status -->
    <StackLayout Padding="10" BackgroundColor="{StaticResource BTLEStatusBackgroundColor}" HorizontalOptions="CenterAndExpand" IsVisible="{Binding IsStateOn, Converter={StaticResource BooleanToFalseConverter}}">
        <Grid HorizontalOptions="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Image HorizontalOptions="End" Source="bluetoothinfo.png" VerticalOptions="Center" />
            <Label Grid.Column="1" FontSize="18" Text="{Binding StateText}" TextColor="{StaticResource BTLEStatusTextColor}" VerticalOptions="Center" />
        </Grid>
    </StackLayout>

    <!-- Sensor ListView -->
    <syncfusion:SfListView x:Name="SensorLiistView"
                           Margin="0" Padding="0"
                           AllowSwiping="False" HeaderSize="40" IsStickyFooter="True" IsStickyGroupHeader="True" ItemDoubleTapped="SensorListView_OnItemDoubleTapped"
                           ItemSize="116" ItemSpacing="0"
                           ItemsSource="{Binding SensorCollection}"
                           SelectionBackgroundColor="Transparent">

        <!-- Sensor ListView Group DataSource -->
        <syncfusion:SfListView.DataSource>
            <dataSource:DataSource>
                <dataSource:DataSource.GroupDescriptors>
                    <dataSource:GroupDescriptor PropertyName="SensorTypeGroup" />
                </dataSource:DataSource.GroupDescriptors>
            </dataSource:DataSource>
        </syncfusion:SfListView.DataSource>

        <!-- Layout Manager (provides columns on higher resolution devices) -->
        <syncfusion:SfListView.LayoutManager>
            <syncfusion:GridLayout>
                <syncfusion:GridLayout.SpanCount>
                    <OnPlatform x:TypeArguments="x:Int32">
                        <OnPlatform.Android>
                            <OnIdiom x:TypeArguments="x:Int32" Phone="1" Tablet="2" />
                        </OnPlatform.Android>
                        <OnPlatform.iOS>
                            <OnIdiom x:TypeArguments="x:Int32" Phone="1" Tablet="2" />
                        </OnPlatform.iOS>
                    </OnPlatform>
                </syncfusion:GridLayout.SpanCount>
            </syncfusion:GridLayout>
        </syncfusion:SfListView.LayoutManager>

        <!-- Sensor ListView Header Template -->
        <syncfusion:SfListView.HeaderTemplate>
            <DataTemplate>
                <StackLayout BackgroundColor="{StaticResource RemoteNameBackgroundColor}"
                             HeightRequest="40" HorizontalOptions="FillAndExpand" Orientation="Horizontal" Spacing="0" VerticalOptions="FillAndExpand">
                    <Label FontSize="20" HorizontalOptions="CenterAndExpand" Text="{Binding DeviceName}" TextColor="{StaticResource HeaderTextColor}" VerticalOptions="Center" />
                </StackLayout>
            </DataTemplate>
        </syncfusion:SfListView.HeaderTemplate>

        <!-- Sensor ListView Group Template -->
        <syncfusion:SfListView.GroupHeaderTemplate>
            <DataTemplate>
                <ViewCell>
                    <ViewCell.View>
                        <Grid Margin="0" Padding="0"
                              ColumnSpacing="0" HorizontalOptions="FillAndExpand" RowSpacing="0" VerticalOptions="FillAndExpand">
                            <!-- Sensor Group Name -->
                            <Label Margin="0,5,0,5"
                                   FontSize="20" HorizontalOptions="CenterAndExpand" HorizontalTextAlignment="Center"
                                   Text="{Binding Key, Converter={StaticResource UpperCaseConverter}}"
                                   TextColor="{StaticResource GroupTextColor}"
                                   VerticalOptions="Center" VerticalTextAlignment="Center" WidthRequest="225" />
                        </Grid>
                    </ViewCell.View>
                </ViewCell>
            </DataTemplate>
        </syncfusion:SfListView.GroupHeaderTemplate>

        <!-- Sensor ListView Item Template -->
        <syncfusion:SfListView.ItemTemplate>
            <DataTemplate>
                <ViewCell>
                    <!-- Sensor Detail Template -->

                    <ContentView.Content>

                        <!-- Sensor Outer Wrapper -->
                        <!-- Margin: left, top, right, bottom -->
                        <StackLayout Margin="0,0,0,0" BackgroundColor="Transparent" Orientation="Vertical" VerticalOptions="CenterAndExpand">
                            <Grid ColumnSpacing="0">

                                <!-- Sensor Alarm Indicator, Sensor Body -->
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="15" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <!-- Sensor Alarm Color Indicator -->
                                <Frame Grid.Column="0"
                                       Margin="0" Padding="0"
                                       BackgroundColor="{Binding AlarmStatus, Converter={StaticResource AlarmStatusColorConverter}}"
                                       CornerRadius="0" HasShadow="False" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand" WidthRequest="15" />

                                <!-- Sensor Inner Wrapper -->
                                <StackLayout Grid.Column="1" Margin="0" Padding="0" Spacing="0">

                                    <Grid Style="{StaticResource CardStyle}">

                                        <!-- Sensor Image, Name/Type/Index/Status, Average Value/Unit -->
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="65" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="160" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Sensor Image -->
                                        <Image Grid.Column="0" Aspect="AspectFit" Scale="1" Source="{Binding SensorImage}" />

                                        <!-- Sensor Name, Type, and TimeStamp -->
                                        <StackLayout Grid.Column="1" Spacing="0" VerticalOptions="Center">
                                            <Label LineBreakMode="TailTruncation" Style="{StaticResource NameStyle}" Text="{Binding Name}" VerticalOptions="Center" />
                                            <Label LineBreakMode="TailTruncation" Style="{StaticResource SensorTypeStyle}" Text="{Binding SensorLabel}" VerticalOptions="Center" />
                                            <Label LineBreakMode="NoWrap" Style="{StaticResource SensorIndexStyle}" Text="{Binding SensorIndexPlusStatus}" VerticalOptions="Center" />
                                        </StackLayout>

                                        <!-- Sensor Average Value and Unit Type -->
                                        <StackLayout Grid.Column="2" Orientation="Horizontal" Spacing="0">

                                            <Frame Style="{StaticResource ValueInnerBoxStyle}">
                                                <StackLayout HorizontalOptions="CenterAndExpand" Orientation="Horizontal" Spacing="0" VerticalOptions="CenterAndExpand">
                                                    <!-- Sensor Average Value -->
                                                    <Label Margin="0"
                                                           HorizontalOptions="End" HorizontalTextAlignment="End" LineBreakMode="NoWrap"
                                                           Style="{StaticResource ValueStyle}"
                                                           Text="{Binding AverageValue, Converter={StaticResource SensorValueValidationConverter}}"
                                                           VerticalOptions="CenterAndExpand" VerticalTextAlignment="Center" />
                                                    <!-- Sensor Unit Type -->
                                                    <Label Margin="0,-20,0,0"
                                                           HorizontalOptions="Start" HorizontalTextAlignment="Start" LineBreakMode="NoWrap"
                                                           Style="{StaticResource ValueUnitTypeStyle}"
                                                           Text="{Binding SensorUnitType}"
                                                           VerticalOptions="CenterAndExpand" VerticalTextAlignment="Start" />
                                                </StackLayout>
                                            </Frame>
                                        </StackLayout>

                                    </Grid>

                                    <!-- Border Line -->
                                    <BoxView Style="{StaticResource LightShadowStyle}" />

                                    <!-- Sensor Footer Wrapper -->
                                    <Grid Style="{StaticResource Footer}">

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="5" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Sensor DateTime -->
                                        <StackLayout Grid.Column="0" HorizontalOptions="FillAndExpand" Spacing="0">
                                            <Label HorizontalTextAlignment="Start" LineBreakMode="NoWrap" Style="{StaticResource TimeStampStyle}" Text="{Binding DateTimeStamp, StringFormat='{}{0:hh\\:mm\\:ss tt}'}" />
                                        </StackLayout>

                                        <!-- Sensor Serial Number -->
                                        <StackLayout Grid.Column="1" HorizontalOptions="FillAndExpand" Spacing="0">
                                            <Label HorizontalTextAlignment="End" LineBreakMode="TailTruncation" Style="{StaticResource SerialNumberStyle}" Text="{Binding SerialNumber}" />
                                        </StackLayout>
                                    </Grid>

                                </StackLayout>

                            </Grid>

                        </StackLayout>

                    </ContentView.Content>

                </ViewCell>
            </DataTemplate>
        </syncfusion:SfListView.ItemTemplate>

        <!-- Sensor ListView Footer Template -->
        <syncfusion:SfListView.FooterTemplate>
            <DataTemplate>
                <!-- Margin: left, top, right, bottom -->
                <StackLayout BackgroundColor="{StaticResource RemoteNameBackgroundColor}"
                             HeightRequest="60" HorizontalOptions="FillAndExpand" Orientation="Horizontal" Spacing="0" VerticalOptions="FillAndExpand">
                    <!-- Sensor BTLE Characteristic Incoming Values -->
                    <Label Margin="5"
                           FontSize="16" HorizontalOptions="StartAndExpand" LineBreakMode="MiddleTruncation"
                           Text="{Binding CharacteristicValue, StringFormat=' Incoming Value: {0:N}'}"
                           TextColor="{StaticResource AppLightColor}"
                           VerticalOptions="CenterAndExpand" VerticalTextAlignment="Center" />
                </StackLayout>
            </DataTemplate>
        </syncfusion:SfListView.FooterTemplate>

    </syncfusion:SfListView>

</pages:BasePage>